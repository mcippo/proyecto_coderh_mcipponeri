library(dplyr)
library(readr)
library(utils)
library(tidyverse)
library(sf)
library(readxl)
library(dplyr)
library(openxlsx)
usuarios <- read.csv("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/transporte-y-obras-publicas/bicicletas-publicas/usuarios_ecobici_2024.csv", sep = ",")
url <- "https://cdn.buenosaires.gob.ar/datosabiertos/datasets/transporte-y-obras-publicas/bicicletas-publicas/recorridos-realizados-2024.zip"
download.file(url, destfile = "procesamientos_r/datos.zip", mode = "wb")
unzip("procesamientos_r/datos.zip", list = TRUE)
unzip("procesamientos_r/datos.zip", files = "badata_ecobici_recorridos_realizados_2024.csv", exdir = "bases")
recorridos <- read_csv("procesamientos_r/badata_ecobici_recorridos_realizados_2024.csv")
recorridos <- read_csv("procesamientos_r/badata_ecobici_recorridos_realizados_2024.csv")
unzip("procesamientos_r/datos.zip", files = "badata_ecobici_recorridos_realizados_2024.csv", exdir = "bases")
unzip("procesamientos_r/datos.zip", files = "badata_ecobici_recorridos_realizados_2024.csv", exdir = "bases")
unzip("procesamientos_r/datos.zip", files = "badata_ecobici_recorridos_realizados_2024.csv", exdir = "procesamientos_r")
recorridos <- read_csv("procesamientos_r/badata_ecobici_recorridos_realizados_2024.csv")
rm(url)
estaciones <- read.csv("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/transporte-y-obras-publicas/estaciones-bicicletas-publicas/nuevas-estaciones-bicicletas-publicas.csv")
View(estaciones)
listado_estaciones <- estaciones %>% select(id,latitud,longitud)
View(listado_estaciones)
barrios <- read_sf("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/ministerio-de-educacion/barrios/barrios.geojson") %>%
rename(barrio=nombre)
puntos <- st_as_sf(listado_estaciones, coords = c("longitud", "latitud"), crs = 4326)
View(puntos)
puntos_con_barrios <- st_join(puntos, barrios[, c("barrio")], join = st_within) %>%
st_drop_geometry()
View(puntos_con_barrios)
estaciones_2 <-  estaciones %>%
select(-c(barrio,comuna,emplazamiento)) %>%
left_join(puntos_con_barrios)
chequeo <- estaciones_2 %>% filter(is.na(barrio))
View(chequeo)
estaciones_2 <- estaciones_2 %>%
mutate(barrio=case_when(nombre=="AEROPARQUE"~"Palermo",
nombre=="MACACHA GUEMES"~"Belgrano",
TRUE~barrio)) %>%
select(1:4,7,5,6) %>%
arrange(id)
View(estaciones_2)
library(dplyr)
library(readr)
library(utils)
library(tidyverse)
library(sf)
library(readxl)
library(dplyr)
library(openxlsx)
library(janitor)
usuarios_2024 <- read.csv("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/transporte-y-obras-publicas/bicicletas-publicas/usuarios_ecobici_2024.csv", sep = ",") %>%
clean_names() %>%
mutate(anio=2024)
usuarios_2023 <- read.csv("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/transporte-y-obras-publicas/bicicletas-publicas/usuarios_ecobici_2023.csv", sep = ",") %>%
clean_names() %>%
select(1:5)%>%
mutate(anio=2023)
usuarios_2022 <- read.csv("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/transporte-y-obras-publicas/bicicletas-publicas/usuarios_ecobici_2022.csv", sep = ",") %>%
clean_names() %>%
select(1:5)%>%
mutate(anio=2022)
usuarios_2021 <- read.csv("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/transporte-y-obras-publicas/bicicletas-publicas/usuarios_ecobici_2021.csv", sep = ",") %>%
clean_names() %>%
select(1:5)%>%
mutate(anio=2021)
usuarios_2020 <- read.csv("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/transporte-y-obras-publicas/bicicletas-publicas/usuarios_ecobici_2020.csv", sep = ",") %>%
clean_names() %>%
select(1:5)%>%
mutate(anio=2021)
usuarios_2019 <- read.csv("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/transporte-y-obras-publicas/bicicletas-publicas/usuarios_ecobici_2019.csv", sep = ",") %>%
clean_names() %>%
select(1:5)%>%
mutate(anio=2019)
usuarios_2018 <- read.csv("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/transporte-y-obras-publicas/bicicletas-publicas/usuarios-ecobici-2018.csv", sep = ",") %>%
clean_names() %>%
select(1:5)%>%
mutate(anio=2018)
usuarios_2017 <- read.csv("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/transporte-y-obras-publicas/bicicletas-publicas/usuarios-ecobici-2017.csv", sep = ",") %>%
clean_names() %>%
select(1:5)%>%
mutate(anio=2017)
usuarios_2016 <- read.csv("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/transporte-y-obras-publicas/bicicletas-publicas/usuarios-ecobici-2016.csv", sep = ",") %>%
clean_names() %>%
select(1:5)%>%
mutate(anio=2016)
usuarios_2015 <- read.csv("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/transporte-y-obras-publicas/bicicletas-publicas/usuarios_ecobici_2025.csv", sep = ",") %>%
clean_names() %>%
select(1:5)%>%
mutate(anio=2015) %>%
rename(id_usuario=id_cliente)
usuarios <- rbind(usuarios_2021,
usuarios_2022,
usuarios_2023,
usuarios_2024,
usuarios_2020,
usuarios_2019,
usuarios_2018,
usuarios_2017,
usuarios_2016,
usuarios_2015)
usuarios_2 <- usuarios %>% arrange(id_usuario,-anio) %>%
distinct(id_usuario, .keep_all = TRUE)
usuarios_final <- usuarios_2 %>%
mutate(id_genero=case_when(genero_usuario=="FEMALE"~1,
genero_usuario=="MALE"~2,
genero_usuario=="OTHER"~3))
write.csv(usuarios_final,"insumos/usuarios.csv",
row.names = FALSE,
na="",
fileEncoding = "Latin1")
rm(usuarios, usuarios_final)
url <- "https://cdn.buenosaires.gob.ar/datosabiertos/datasets/transporte-y-obras-publicas/bicicletas-publicas/recorridos-realizados-2024.zip"
download.file(url, destfile = "procesamientos_r/datos.zip", mode = "wb")
unzip("procesamientos_r/datos.zip", list = TRUE)
unzip("procesamientos_r/datos.zip", files = "badata_ecobici_recorridos_realizados_2024.csv", exdir = "procesamientos_r")
recorridos <- read_csv("procesamientos_r/badata_ecobici_recorridos_realizados_2024.csv")
recorridos_final <- recorridos %>%
mutate(id_mes=month(fecha_origen_recorrido),
calificacion=sample(1:10, size = n(), replace = TRUE),
id_modelo=sample(1:2, size = n(), replace = TRUE),
id_precio=id_mes) %>%
select(id_recorrido,id_usuario,id_estacion_orig=id_estacion_origen,
id_mes,fecha_origen=fecha_origen_recorrido,
id_estacion_dest=id_estacion_destino,
fecha_dest=fecha_destino_recorrido,id_modelo,calificacion,id_precio)
write.csv(recorridos_final,"insumos/recorridos.csv",
row.names = FALSE,
na="",
fileEncoding = "Latin1")
recorridos <- read.csv("insumos/recorridos.csv")
usuarios <- read.csv("insumos/usuarios.csv")
lista_usuarios <- usuarios %>% select(id_usuario) %>%
mutate(asigna=1)
recorridos_final <- left_join(recorridos,lista_usuarios)
recorridos_final <- recorridos_final %>%
filter(asigna==1) %>%
select(-asigna)
write.csv(recorridos_final,"insumos/bases_finales/recorridos.csv",
row.names = FALSE,
na="",
fileEncoding = "Latin1")
usuarios_recorridos <- recorridos_final %>%
group_by(id_usuario) %>%
summarise(filtro=1)
usuarios_final <- left_join(usuarios,usuarios_recorridos) %>%
filter(filtro==1) %>%
select(-filtro)
write.csv(usuarios_final,"insumos/bases_finales/usuarios.csv",
row.names = FALSE,
na="",
fileEncoding = "Latin1")
usuarios <- read.csv("insumos/bases_finales/usuarios.csv")
usuarios_sample <- usuarios[sample(nrow(usuarios), 500), ]
write.csv(usuarios_sample,"insumos/bases_finales/usuarios_sample.csv",
row.names = FALSE,
na="",
fileEncoding = "Latin1")
lista <- usuarios_sample %>%
mutate(filtro=1) %>%
select(id_usuario,filtro)
recorridos <- read.csv("insumos/bases_finales/recorridos.csv")
recorridos_sample <- left_join(recorridos,lista)
recorridos_sample <- recorridos_sample %>%
filter(filtro==1)
table(recorridos_sample$filtro)
View(recorridos_sample)
View(usuarios_sample)
recorridos <- read.csv("insumos/recorridos.csv")
usuarios <- read.csv("insumos/usuarios.csv")
names(usuarios)
usuarios <- read.csv("insumos/usuarios.csv") %>%
select(id_usuario,id_genero,edad_usuario,fecha_alta,hora_alta)
names(recorridos)
lista_usuarios <- usuarios %>% select(id_usuario) %>%
mutate(asigna=1)
recorridos_final <- left_join(recorridos,lista_usuarios)
recorridos_final <- recorridos_final %>%
filter(asigna==1) %>%
select(-asigna)
write.csv(recorridos_final,"insumos/bases_finales/recorridos.csv",
row.names = FALSE,
na="",
fileEncoding = "Latin1")
usuarios_recorridos <- recorridos_final %>%
group_by(id_usuario) %>%
summarise(filtro=1)
usuarios_final <- left_join(usuarios,usuarios_recorridos) %>%
filter(filtro==1) %>%
select(-filtro)
# Se guarda la lista de usuarios final:
write.csv(usuarios_final,"insumos/bases_finales/usuarios.csv",
row.names = FALSE,
na="",
fileEncoding = "Latin1")
names(usuarios_final)
usuarios <- read.csv("insumos/bases_finales/usuarios.csv")
usuarios_sample <- usuarios[sample(nrow(usuarios), 500), ]
write.csv(usuarios_sample,"insumos/bases_finales/usuarios_sample.csv",
row.names = FALSE,
na="",
fileEncoding = "Latin1")
lista <- usuarios_sample %>%
mutate(filtro=1) %>%
select(id_usuario,filtro)
recorridos <- read.csv("insumos/bases_finales/recorridos.csv")
recorridos_sample <- left_join(recorridos,lista)
# Se filtran los casos a los que se les asignó un usuario de las lista sample
recorridos_sample <- recorridos_sample %>%
filter(filtro==1)
table(recorridos_sample$filtro)
# Se guarda el sample de los recorridos
write.csv(recorridos_sample,"insumos/bases_finales/recorridos_sample.csv",
row.names = FALSE,
na="",
fileEncoding = "Latin1")
View(usuarios_sample)
chequeo <- read.csv2(file = "insumos/bases_finales/chequeo.csv")
chequeo <- read.csv(file = "insumos/bases_finales/chequeo.csv")
View(chequeo)
chequeo <- chequeo %>%
select(id_usuario) %>%
mutate(filtro=1)
View(chequeo)
x <- left_join(usuarios_sample,chequeo)
View(x)
x2 <- x %>% filter(is.na(filtro))
View(x2)
library(dplyr)
library(readr)
library(utils)
library(tidyverse)
library(sf)
library(readxl)
library(dplyr)
library(openxlsx)
library(janitor)
#### Se cargan los paquetes ####
library(dplyr)
library(readr)
library(utils)
library(tidyverse)
library(sf)
library(readxl)
library(dplyr)
library(openxlsx)
library(janitor)
# Comparación base usuarios y recorridos:
recorridos <- read.csv("insumos/recorridos.csv")
usuarios <- read.csv("insumos/usuarios.csv") %>%
select(id_usuario,id_genero,edad_usuario,fecha_alta,hora_alta)
names(recorridos)
sum(recorridos$id_recorrido[is.na(recorridos$id_recorrido)])
sum(is.na(recorridos$id_recorrido))
sum(is.na(recorridos$id_usuario))
sum(is.na(recorridos$id_estacion_orig))
sum(is.na(recorridos$calificacion))
sum(is.na(recorridos$id_recorrido))
sum(is.na(recorridos$id_usuario))
sum(is.na(recorridos$id_estacion_orig))
sum(is.na(recorridos$id_mes))
sum(is.na(recorridos$fecha_origen))
sum(is.na(recorridos$id_estacion_dest))
sum(is.na(recorridos$fecha_dest))
sum(is.na(recorridos$id_modelo))
sum(is.na(recorridos$calificacion))
sum(is.na(recorridos$id_precio))
usuarios <- read.csv("insumos/usuarios.csv") %>%
select(id_usuario,id_genero,edad_usuario,fecha_alta,hora_alta)
sum(is.na(recorridos$id_precio))
sum(is.na(usuarios$id_usuario))
sum(is.na(usuarios$id_genero))
sum(is.na(usuarios$edad_usuario))
sum(is.na(usuarios$fecha_alta))
sum(is.na(usuarios$hora_alta))
table(usuarios$id_genero)
prop.table(usuarios$id_genero)
table(usuarios$id_genero)
usuarios <- usuarios %>%
mutate(id_genero=ifelse(is.na(id_genero),3,id_genero))
table(usuarios$id_genero)
lista_usuarios <- usuarios %>% select(id_usuario) %>%
mutate(asigna=1)
recorridos_final <- left_join(recorridos,lista_usuarios)
recorridos_final <- recorridos_final %>%
filter(asigna==1) %>%
select(-asigna)
x <- recorridos_final[1:10,]
write.csv(recorridos_final,"insumos/bases_finales/recorridos.csv",
row.names = FALSE,
na="",
fileEncoding = "Latin1")
usuarios_recorridos <- recorridos_final %>%
group_by(id_usuario) %>%
summarise(filtro=1)
usuarios_final <- left_join(usuarios,usuarios_recorridos) %>%
filter(filtro==1) %>%
select(-filtro)
write.csv(usuarios_final,"insumos/bases_finales/usuarios.csv",
row.names = FALSE,
na="",
fileEncoding = "Latin1")
usuarios <- read.csv("insumos/bases_finales/usuarios.csv")
usuarios_sample <- usuarios[sample(nrow(usuarios), 500), ]
write.csv(usuarios_sample,"insumos/bases_finales/usuarios_sample.csv",
row.names = FALSE,
na="",
fileEncoding = "Latin1")
lista <- usuarios_sample %>%
mutate(filtro=1) %>%
select(id_usuario,filtro)
recorridos <- read.csv("insumos/bases_finales/recorridos.csv")
recorridos_sample <- left_join(recorridos,lista)
recorridos_sample <- recorridos_sample %>%
filter(filtro==1)
table(recorridos_sample$filtro)
# Se guarda el sample de los recorridos
write.csv(recorridos_sample,"insumos/bases_finales/recorridos_sample.csv",
row.names = FALSE,
na="",
fileEncoding = "Latin1")
chequeo <- read.csv(file = "insumos/bases_finales/chequeo.csv")
chequeo <- chequeo %>%
select(id_usuario) %>%
mutate(filtro=1)
x <- left_join(usuarios_sample,chequeo)
x2 <- x %>% filter(is.na(filtro))
View(x2)
class(x2$hora_alta)
x2 <- x2 %>%
mutate(hora_alta=as.POSIXct(hora_alta, format="%I:%M:%S %p"), "%H:%M:%S")
View(x2)
chequeo <- read.csv(file = "insumos/bases_finales/chequeo.csv")
chequeo <- chequeo %>%
select(id_usuario) %>%
mutate(filtro=1)
x <- left_join(usuarios_sample,chequeo)
x2 <- x %>% filter(is.na(filtro))
class(x2$hora_alta)
x2 <- x2 %>%
mutate(
hora_alta = as.POSIXct(hora_alta, format="%I:%M:%S %p")
)
View(x2)
chequeo <- read.csv(file = "insumos/bases_finales/chequeo.csv")
chequeo <- chequeo %>%
select(id_usuario) %>%
mutate(filtro=1)
x <- left_join(usuarios_sample,chequeo)
x2 <- x %>% filter(is.na(filtro))
class(x2$hora_alta)
x2 <- x2 %>%
mutate(
hora_alta = as.POSIXct(hora_alta)
)
chequeo <- read.csv(file = "insumos/bases_finales/chequeo.csv")
chequeo <- chequeo %>%
select(id_usuario) %>%
mutate(filtro=1)
x <- left_join(usuarios_sample,chequeo)
x2 <- x %>% filter(is.na(filtro))
class(x2$hora_alta)
x2 <- x2 %>%
mutate(
hora_alta = as.POSIXct(hora_alta, format="%I:%M:%S %p")
)
View(x2)
chequeo <- read.csv(file = "insumos/bases_finales/chequeo.csv")
chequeo <- chequeo %>%
select(id_usuario) %>%
mutate(filtro=1)
x <- left_join(usuarios_sample,chequeo)
x2 <- x %>% filter(is.na(filtro))
class(x2$hora_alta)
View(x2)
usuarios <- read.csv("insumos/usuarios.csv") %>%
select(id_usuario,id_genero,edad_usuario,fecha_alta,hora_alta)
usuarios <- usuarios %>%
mutate(id_genero=ifelse(is.na(id_genero),3,id_genero))
table(usuarios$id_genero)
x <- usuarios %>%
filter(str_detect(hora_alta, "AM|PM"))
View(x2)
chequeo <- usuarios %>%
filter(str_detect(hora_alta, "AM|PM"))
View(chequeo)
chequeo <- chequeo %>%
mutate(hora_alta = sub(" ?(AM|PM)$", "", hora_alta, ignore.case = TRUE))
View(chequeo)
usuarios <- usuarios %>%
mutate(hora_alta = sub(" ?(AM|PM)$", "", hora_alta, ignore.case = TRUE))
chequeo <- usuarios %>%
filter(str_detect(hora_alta, "AM|PM"))
View(chequeo)
rm(chequeo)
lista_usuarios <- usuarios %>% select(id_usuario) %>%
mutate(asigna=1)
recorridos_final <- left_join(recorridos,lista_usuarios)
recorridos_final <- recorridos_final %>%
filter(asigna==1) %>%
select(-asigna)
write.csv(recorridos_final,"insumos/bases_finales/recorridos.csv",
row.names = FALSE,
na="",
fileEncoding = "Latin1")
usuarios_recorridos <- recorridos_final %>%
group_by(id_usuario) %>%
summarise(filtro=1)
usuarios_final <- left_join(usuarios,usuarios_recorridos) %>%
filter(filtro==1) %>%
select(-filtro)
write.csv(usuarios_final,"insumos/bases_finales/usuarios.csv",
row.names = FALSE,
na="",
fileEncoding = "Latin1")
usuarios <- read.csv("insumos/bases_finales/usuarios.csv")
usuarios_sample <- usuarios[sample(nrow(usuarios), 500), ]
write.csv(usuarios_sample,"insumos/bases_finales/usuarios_sample.csv",
row.names = FALSE,
na="",
fileEncoding = "Latin1")
lista <- usuarios_sample %>%
mutate(filtro=1) %>%
select(id_usuario,filtro)
recorridos <- read.csv("insumos/bases_finales/recorridos.csv")
recorridos_sample <- left_join(recorridos,lista)
# Se filtran los casos a los que se les asignó un usuario de las lista sample
recorridos_sample <- recorridos_sample %>%
filter(filtro==1)
table(recorridos_sample$filtro)
# Se guarda el sample de los recorridos
write.csv(recorridos_sample,"insumos/bases_finales/recorridos_sample.csv",
row.names = FALSE,
na="",
fileEncoding = "Latin1")
View(usuarios_sample)
View(recorridos_sample)
recorrido_sample <- recorrido_sample %>%
select(-filtro)
recorridos_sample <- recorridos_sample %>%
select(-filtro)
View(recorridos_sample)
write.csv(recorridos_sample,"insumos/bases_finales/recorridos_sample.csv",
row.names = FALSE,
na="",
fileEncoding = "Latin1")
chequeo <- read.csv(file = "insumos/bases_finales/chequeo.csv")
chequeo <- read.csv(file = "insumos/bases_finales/chequeo.csv")
chequeo <- read.csv(file = "insumos/bases_finales/chequeo.csv")
View(chequeo)
chequeo <- read.csv2(file = "insumos/bases_finales/chequeo.csv")
View(chequeo)
chequeo <- chequeo %>%
select(id_recorrido) %>%
mutate(filtro=1)
x <- left_join(recorridos_sample,chequeo)
x2 <- x %>% filter(is.na(filtro))
View(x2)
table(x2)
table(x2$id_usuario)
View(usuarios_sample)
table(x2$id_estacion_orig)
View(x2)
estaciones <- read.csv("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/transporte-y-obras-publicas/estaciones-bicicletas-publicas/nuevas-estaciones-bicicletas-publicas.csv")
View(estaciones)
tinytex::tlmgr_install("babel-spanish")
library(dplyr)
library(readr)
library(utils)
library(tidyverse)
library(sf)
library(readxl)
library(dplyr)
library(openxlsx)
library(janitor)
read.csv2("insumos/bases_finales/usuarios.csv")
x <- read.csv2("insumos/bases_finales/usuarios.csv")
x <- read.csv2("insumos/bases_finales/recorridos.csv")
3308819/1000000
