SOLUCIONES EJERCICIOS

Ejercicio 1

DELIMITER //
CREATE FUNCTION total_prestamos_cliente(p_idcliente INT)
RETURNS INT
DETERMINISTIC
BEGIN
    DECLARE total INT;

    SELECT COUNT(*) INTO total
    FROM prestamos
    WHERE idcliente = p_idcliente;

    RETURN total;
END //
DELIMITER ;

-- Ejemplo de uso:
SELECT total_prestamos_cliente(1) AS prestamos_cliente1;



Ejercicio 2 

DELIMITER //
CREATE FUNCTION disponibilidad_libro(p_idlibro INT)
RETURNS VARCHAR(20)
DETERMINISTIC
BEGIN
    DECLARE estado VARCHAR(20);
    DECLARE stock INT;

    SELECT cantidad INTO stock
    FROM libros
    WHERE idlibros = p_idlibro;

    IF stock > 0 THEN
        SET estado = 'Disponible';
    ELSE
        SET estado = 'Agotado';
    END IF;

    RETURN estado;
END //
DELIMITER ;

-- Ejemplo de uso:
SELECT disponibilidad_libro(1) AS estado_libro;




Ejercicio 3:

DELIMITER //
CREATE PROCEDURE libros_por_genero(IN p_idgenero INT)
BEGIN
    SELECT l.nombre AS titulo, a.nombre AS autor, a.apellido
    FROM libros l
    INNER JOIN autores a ON l.idautor = a.idautor
    WHERE l.idgenero = p_idgenero;
END //
DELIMITER ;

-- Ejemplo de uso:
CALL libros_por_genero(2);

Ejercicio 4


DELIMITER //
CREATE PROCEDURE ultima_fecha_prestamo(IN p_idcliente INT)
BEGIN
    DECLARE ultima DATE;

    SELECT MAX(fecha_prestamo) INTO ultima
    FROM prestamos
    WHERE idcliente = p_idcliente;

    IF ultima IS NULL THEN
        SELECT 'Sin pr√©stamos' AS resultado;
    ELSE
        SELECT ultima AS ultima_fecha;
    END IF;
END //
DELIMITER ;

-- Ejemplo de uso:
CALL ultima_fecha_prestamo(1);


